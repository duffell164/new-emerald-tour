<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emerald Tour Leaderboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }

        /* --- STICKY BRANDING SECTION --- */
        .sticky-top-wrap {
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .main-header { 
            background-color: #1b5e20; 
            color: white; 
            text-align: center; 
            padding: 15px; 
            font-weight: bold; 
            font-size: 24px; 
            border-bottom: 4px solid #fbc02d; 
            text-transform: uppercase; 
        }
        .info-bar { 
            background-color: #333; 
            color: #ffeb3b; 
            padding: 10px 20px; 
            display: flex; 
            justify-content: center; 
            gap: 40px; 
            align-items: center; 
            font-size: 14px; 
            font-weight: bold; 
        }
        .venue-section { 
            text-align: center; 
            padding: 15px 0; 
            background: white; 
            border-bottom: 1px solid #ddd; 
        }
        .venue-section h2 { color: #1b5e20; margin: 0; font-size: 24px; text-transform: uppercase; }
        .venue-section p { font-weight: bold; margin: 5px 0 0 0; font-size: 16px; color: #333; }

        /* --- CONTENT AREA --- */
        .content-padding { padding: 20px; }
        .section-title { text-align:center; color:#1b5e20; text-transform: uppercase; margin-top: 30px; margin-bottom: 15px; }

        .table-container { 
            width: 100%; 
            overflow-x: auto; 
            background-color: white; 
            border: 1px solid #ddd;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        table { width: 100%; border-collapse: collapse; min-width: 1000px; }

        th { 
            background-color: #1b5e20; 
            color: white; 
            padding: 12px; 
            text-transform: uppercase; 
            font-size: 12px;
            border-bottom: 2px solid #fbc02d;
        }

        td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; background-color: white; }
        
        /* AUTHENTIC BRANDED ICONS */
        .platform-icon { 
            width: 22px; /* Slightly larger for the 'X' circle */
            height: 22px; 
            vertical-align: middle; 
            margin-right: 10px; 
            object-fit: contain; 
        }
        
        /* Genuine Xbox Green (#107C10) applied to the sphere */
        .icon-xbox { filter: invert(32%) sepia(93%) saturate(1315%) hue-rotate(85deg) brightness(97%) contrast(102%); }
        
        /* Genuine PlayStation Blue (#0037AE) */
        .icon-ps { filter: invert(13%) sepia(95%) saturate(5451%) hue-rotate(219deg) brightness(91%) contrast(106%); }
        
        .icon-pc { filter: invert(46%) sepia(85%) saturate(1514%) hue-rotate(174deg) brightness(101%) contrast(102%); }
        .icon-steam { filter: none; } 

        .top-tier td { background-color: #f0f7f0 !important; }
    </style>
</head>
<body>

    <div class="sticky-top-wrap">
        <div class="main-header">NEW EMERALD TOUR LEADERBOARD</div>
        <div class="info-bar">
            <div>DATE: <span id="event-date" style="color: white;">--</span></div>
            <div>PAR: <span id="course-par" style="color: white;">--</span></div>
        </div>
        <div class="venue-section">
            <h2 id="current-venue">Loading...</h2>
            <p id="total-prize-pool">Total Prize Pool: --</p>
        </div>
    </div>

    <div class="content-padding">
        
        <h3 class="section-title">Tournament Leaderboard</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>POS</th><th style="text-align:left;">PLAYER</th><th>TO PAR</th>
                        <th>R1</th><th>R2</th><th>R3</th><th>R4</th><th>TOTAL</th><th>PRIZES</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
        </div>

        <h3 class="section-title">Season Stats</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Rank</th><th style="text-align:left;">Player</th><th>Points</th><th>Earnings</th>
                        <th>Events</th><th>FIR %</th><th>GIR %</th><th>Scram</th><th>NTP</th>
                    </tr>
                </thead>
                <tbody id="stats-body"></tbody>
            </table>
        </div>

        <h3 class="section-title">Tournament History</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Season</th><th style="text-align:left;">Event/Venue</th><th>Winner</th><th>Score</th><th>Prize</th>
                    </tr>
                </thead>
                <tbody id="history-body"></tbody>
            </table>
        </div>

    </div>

    <script>
        const LB_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSoGXmOEYNiMsVMIlQv-PCbb_rMZibcL8t1nhjgwUeT-Fi35kBGD6ED81g7zQEsa726jVI7jax5Tvbx/pub?gid=0&single=true&output=csv';
        const STATS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSoGXmOEYNiMsVMIlQv-PCbb_rMZibcL8t1nhjgwUeT-Fi35kBGD6ED81g7zQEsa726jVI7jax5Tvbx/pub?gid=349486530&single=true&output=csv';
		const HISTORY_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSoGXmOEYNiMsVMIlQv-PCbb_rMZibcL8t1nhjgwUeT-Fi35kBGD6ED81g7zQEsa726jVI7jax5Tvbx/pub?gid=1886101746&single=true&output=csv'

        const platformIcons = {
            'ps': 'https://upload.wikimedia.org/wikipedia/commons/0/00/PlayStation_logo.svg',
            // Updated to the "X" Sphere only
            'xbox': 'https://upload.wikimedia.org/wikipedia/commons/f/f9/Xbox_one_logo.svg',
            'pc': 'https://upload.wikimedia.org/wikipedia/commons/a/ae/Windows_logo_-_2012.svg',
            'steam': 'https://upload.wikimedia.org/wikipedia/commons/8/83/Steam_icon_logo.svg'
        };

        async function loadData() {
            try {
                const [lbRes, statsRes, histRes] = await Promise.all([
                    fetch(LB_URL), fetch(STATS_URL), fetch(HISTORY_URL)
                ]);
                renderData(await lbRes.text(), await statsRes.text(), await histRes.text());
            } catch (err) { console.error(err); }
        }

        function renderData(lbCsv, statsCsv, histCsv) {
            const lbRows = lbCsv.split(/\r?\n/).map(r => r.split(','));
            const statsRows = statsCsv.split(/\r?\n/).map(r => r.split(','));
            const histRows = histCsv.split(/\r?\n/).map(r => r.split(','));

            const meta = lbRows[1];
            const parVal = parseInt(meta[11]) || 72;
            document.getElementById('current-venue').innerText = meta[10] || "Tournament";
            document.getElementById('course-par').innerText = parVal;
            document.getElementById('total-prize-pool').innerText = `Total Prize Pool: ${meta[12] || "--"}`;
            document.getElementById('event-date').innerText = meta[13] || "--";

            const lbBody = document.getElementById('leaderboard-body');
            lbBody.innerHTML = "";
            let players = lbRows.slice(1).map(col => {
                const name = col[1] ? col[1].trim() : "";
                if(!name || name === "" || name === "Player Name" || name === "PLAYER") return null;
                const plat = col[2] ? col[2].trim().toLowerCase() : "";
                let iconUrl = ""; let iconClass = "";
                if (plat.includes("ps")) { iconUrl = platformIcons.ps; iconClass = "icon-ps"; }
                else if (plat.includes("xb")) { iconUrl = platformIcons.xbox; iconClass = "icon-xbox"; }
                else if (plat.includes("steam")) { iconUrl = platformIcons.steam; iconClass = "icon-steam"; }
                else if (plat.includes("pc")) { iconUrl = platformIcons.pc; iconClass = "icon-pc"; }

                const iconHtml = iconUrl ? `<img src="${iconUrl}" class="platform-icon ${iconClass}" crossorigin="anonymous">` : "";
                const rounds = [col[3], col[4], col[5], col[6]].map(s => parseInt(s) || 0);
                const active = rounds.filter(s => s > 0);
                const total = active.reduce((a, b) => a + b, 0);
                let toPar = "--", sort = 999;
                if(active.length > 0) {
                    sort = total - (parVal * active.length);
                    toPar = sort > 0 ? `+${sort}` : (sort === 0 ? "E" : sort);
                }
                return { name, iconHtml, r: rounds, total, toPar, sort, prize: col[8] || "--" };
            }).filter(p => p).sort((a,b) => a.sort - b.sort);

            players.forEach((p, i) => {
                const pText = p.toPar.toString();
                let color = "black"; 
                if (pText === 'E') color = "green"; 
                else if (!pText.includes('+') && pText !== "--") color = "red"; 

                const tiedAbove = i > 0 && players[i-1].sort === p.sort;
                const tiedBelow = i < players.length - 1 && players[i+1].sort === p.sort;
                let posDisplay = i + 1;
                if (tiedAbove || tiedBelow) {
                    const firstTiedIndex = players.findIndex(player => player.sort === p.sort);
                    posDisplay = "T" + (firstTiedIndex + 1);
                }
                lbBody.innerHTML += `<tr><td>${posDisplay}</td><td style="text-align:left; font-weight:bold;">${p.iconHtml}${p.name}</td><td style="font-weight:bold; color:${color}">${pText}</td><td>${p.r[0]||'-'}</td><td>${p.r[1]||'-'}</td><td>${p.r[2]||'-'}</td><td>${p.r[3]||'-'}</td><td><b>${p.total||'-'}</b></td><td>${p.prize}</td></tr>`;
            });

            const statsBody = document.getElementById('stats-body');
            statsBody.innerHTML = "";
            let stats = statsRows.slice(1).map(col => {
                const name = col[0] ? col[0].trim() : "";
                if(!name || name === "" || name === "Player" || name === "Player Name") return null;
                return { name, pts: col[1], earn: col[2], ev: col[3], f: col[4], g: col[5], s: col[6], n: col[7], val: parseFloat(col[2]?.replace(/[^0-9.-]+/g,"")) || 0 };
            }).filter(s => s).sort((a,b) => b.val - a.val);

            stats.forEach((s, i) => {
                const rowClass = i < Math.ceil(stats.length/2) ? 'class="top-tier"' : '';
                statsBody.innerHTML += `<tr ${rowClass}><td>${i+1}</td><td style="text-align:left; font-weight:bold;">${s.name}</td><td>${s.pts}</td><td style="color:#1b5e20; font-weight:bold;">${s.earn}</td><td>${s.ev}</td><td>${s.f}</td><td>${s.g}</td><td>${s.s}</td><td>${s.n}</td></tr>`;
            });

            const histBody = document.getElementById('history-body');
            histBody.innerHTML = "";
            histRows.slice(1).forEach(col => {
                const season = col[0] ? col[0].trim() : "";
                if(!season || season === "Season") return;
                histBody.innerHTML += `<tr><td>${season}</td><td style="text-align:left; font-weight:bold;">${col[1]}</td><td>${col[2]}</td><td>${col[3]}</td><td style="color:#1b5e20;">${col[4]}</td></tr>`;
            });
        }
        loadData();
    </script>
</body>
</html>
