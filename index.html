<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emerald Tour Leaderboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #fff; }
        
        /* Main Banner */
        .main-header {
            background-color: #1b5e20;
            color: white;
            text-align: center;
            padding: 15px;
            font-weight: bold;
            font-size: 24px;
            border-bottom: 4px solid #fbc02d;
            text-transform: uppercase;
        }

        /* Black Info Bar */
        .info-bar {
            background-color: #333;
            color: #ffeb3b;
            padding: 10px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            font-weight: bold;
            border-bottom: 2px solid #555;
        }

        /* Venue Section */
        .venue-section { text-align: center; padding: 25px 0 10px 0; }
        .venue-section h2 { color: #1b5e20; margin: 0; font-size: 32px; text-transform: uppercase; }
        .venue-section p { font-weight: bold; margin: 10px 0; font-size: 20px; color: #333; }

        /* Tables */
        .table-wrapper { width: 100%; overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 50px; }
        th { background-color: #1b5e20; color: white; padding: 12px; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }

        /* Platform Icons */
        .platform-icon { width: 18px; height: 18px; vertical-align: middle; margin-right: 8px; }

        /* Soft Emerald Gradient for Top 50% (Season Stats) */
        .top-tier {
            background: linear-gradient(90deg, rgba(27, 94, 32, 0.12) 0%, rgba(255, 255, 255, 0) 100%) !important;
        }
        .top-tier td:first-child { border-left: 5px solid #1b5e20; }
    </style>
</head>
<body>

    <div class="main-header">NEW EMERALD TOUR LEADERBOARD</div>

    <div class="info-bar">
        <div>DATE: <span id="event-date" style="color: white;">--</span></div>
        <div>PAR: <span id="course-par" style="color: white;">--</span></div>
    </div>

    <div class="venue-section">
        <h2 id="current-venue">Loading Venue...</h2>
        <p id="total-prize-pool">Total Prize Pool: --</p>
    </div>

    <div class="table-wrapper">
        <h3 style="text-align:center; color:#1b5e20;">SEASON STANDINGS</h3>
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th style="text-align:left; padding-left:15px;">Player</th>
                    <th>Events</th>
                    <th>Wins</th>
                    <th style="text-align:right; padding-right:20px;">Earnings</th>
                </tr>
            </thead>
            <tbody id="season-stats-body">
                </tbody>
        </table>
    </div>

    <script>
        // Replace this URL with your actual Google Sheets Published CSV link
        const sheetUrl = 'YOUR_GOOGLE_SHEETS_CSV_URL_HERE';

        async function fetchData() {
            try {
                const response = await fetch(sheetUrl);
                const csvData = await response.text();
                renderAll(csvData);
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        function renderAll(csv) {
            const rows = csv.split(/\r?\n/).filter(row => row.trim() !== "");
            if (rows.length < 2) return;

            // 1. Update Headers (Pulling from Row 2 / Index 2)
            const meta = rows[2].split(',').map(item => item.trim());
            document.getElementById('current-venue').innerText = meta[10] || "Tournament Venue";
            document.getElementById('course-par').innerText = meta[11] || "72";
            document.getElementById('total-prize-pool').innerText = `Total Prize Pool: ${meta[12] || "$0"}`;
            document.getElementById('event-date').innerText = meta[13] || "TBD";

            // 2. Render Season Stats
            renderSeasonStats(rows);
        }

        function renderSeasonStats(rows) {
            const tbody = document.getElementById('season-stats-body');
            tbody.innerHTML = '';

            // Map data from CSV (Assumes Name: B, Events: C, Wins: D, Earnings: E)
            let players = rows.slice(1).map(row => {
                const col = row.split(',').map(item => item.trim());
                return {
                    name: col[1],
                    events: col[2],
                    wins: col[3],
                    earnings: col[4],
                    numEarnings: parseFloat((col[4] || "0").replace(/[^0-9.-]+/g,""))
                };
            }).filter(p => p.name); // Filter out empty rows

            // Sort by earnings
            players.sort((a, b) => b.numEarnings - a.numEarnings);

            // Calculate Top 50%
            const halfPoint = Math.ceil(players.length / 2);

            players.forEach((player, index) => {
                const isTopHalf = index < halfPoint;
                const rowClass = isTopHalf ? 'class="top-tier"' : '';

                tbody.innerHTML += `
                    <tr ${rowClass}>
                        <td style="font-weight:bold;">${index + 1}</td>
                        <td style="text-align:left; padding-left:15px;">${player.name}</td>
                        <td>${player.events}</td>
                        <td>${player.wins}</td>
                        <td style="text-align:right; padding-right:20px; font-weight:bold; color:#1b5e20;">${player.earnings}</td>
                    </tr>
                `;
            });
        }

        // Initialize
        fetchData();
    </script>
</body>
</html>
