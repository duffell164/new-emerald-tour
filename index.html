<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Emerald Tour Leaderboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        
        .leaderboard-container {
            max-width: 1300px;
            margin: 0 auto;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden; /* Keeps header from scrolling */
        }

        /* FIXED HEADER SECTION */
        .header {
            background: linear-gradient(135deg, #124d12 0%, #228B22 50%, #1a5e1a 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            font-size: 24px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 4px solid #FFD700;
            position: relative;
        }
        .header img { height: 45px; vertical-align: middle; }
        .logo-left { margin-right: 20px; }
        .logo-right { margin-left: 20px; }

        .info-bar { display: flex; justify-content: space-around; background: #333; color: #ddd; padding: 12px; font-size: 14px; }
        .info-item { font-weight: bold; color: #FFD700; }
        .info-item span { color: white; margin-left: 5px; }

        .venue { background: #444; color: #FFFFF7; padding: 12px; text-align: center; font-size: 18px; font-weight: bold; }
        .venue.major { background: linear-gradient(90deg, #8B6914 0%, #FFD700 50%, #8B6914 100%) !important; color: #000 !important; }

        /* SCROLLABLE TABLE SECTION */
        .table-wrapper {
            width: 100%;
            overflow-x: auto; /* This enables the horizontal swipe */
            -webkit-overflow-scrolling: touch;
        }

        .platform-icon {
            width: 16px;
            height: 16px;
            vertical-align: middle;
            margin-right: 10px;
            /* This helps the black Steam logo stand out on dark or light themes */
            filter: brightness(1); 
        }

        .best-stat {
            color: #d32f2f; /* Professional red */
            font-weight: 800; /* Extra bold */
        }
		
		/* Soft Emerald Gradient for Top 50% */
		.top-tier {
			background: linear-gradient(90deg, rgba(27, 94, 32, 0.15) 0%, rgba(255, 255, 255, 0) 100%) !important;
		}

        table { width: 100%; border-collapse: collapse; min-width: 900px; } /* Min-width forces scroll on small screens */
        th { background-color: #e6e6e6; padding: 12px; text-align: left; font-size: 13px; border-bottom: 2px solid #ddd; color: #444; }
        td { padding: 10px 12px; border-bottom: 1px solid #eee; font-size: 15px; }

        .pos { font-weight: bold; width: 50px; text-align: center; background: #f9f9f9; }
        .player-name { font-weight: 600; color: #1a5e1a; }
        .to-par { font-weight: bold; text-align: center; font-size: 16px; width: 80px; }
        .to-par.under { color: #d32f2f; }
        .to-par.even { color: #2e7d32; }
        .round-score { text-align: center; width: 60px; color: #666; }
        .total { font-weight: bold; text-align: center; width: 70px; background: #fcfcfc; }
        .prize { font-weight: bold; text-align: center; color: #124d12; width: 110px; }

        /* BONUS & HOF SECTIONS */
        .bonus-container, .hof-container { padding: 20px; }
        .section-title { background: #eee; padding: 10px; font-weight: bold; margin-top: 20px; border-radius: 4px; }
        .hof-cards { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin-top: 15px; }
        .hof-card { background: #1a1a1a; color: white; padding: 15px; border-radius: 8px; text-align: center; width: 180px; border: 1px solid #FFD700; }
        
        @media (max-width: 600px) {
            .header { font-size: 18px; padding: 20px 10px; }
            .header img { height: 30px; }
        }
    </style>
</head>
<body>

<div class="leaderboard-container">
    <div class="header">
        NEW EMERALD TOUR LEADERBOARD
    </div>

<div style="background-color: #333; color: #ffeb3b; padding: 10px 40px; display: flex; justify-content: space-between; align-items: center; font-size: 16px; font-weight: bold; border-bottom: 2px solid #555;">
    <div>DATE: <span id="event-date" style="color: white; margin-left: 10px;">--</span></div>
    <div>PAR: <span id="course-par" style="color: white; margin-left: 10px;">--</span></div>
</div>

<div style="text-align: center; padding: 25px 0 10px 0;">
    <h2 id="current-venue" style="color: #1b5e20; margin: 0; font-size: 32px; text-transform: uppercase;">Loading...</h2>
    <p id="total-prize-pool" style="font-weight: bold; margin: 10px 0; font-size: 20px; color: #333;">Total Prize Pool: --</p>
</div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>POS</th>
                        <th>PLAYER</th>
                        <th>TO PAR</th>
                        <th>R1</th>
                        <th>R2</th>
                        <th>R3</th>
                        <th>R4</th>
                        <th>TOT</th>
                        <th>PRIZE</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
        </div>
        
        <div class="section-title">SEASON STATS</div>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>PLAYER</th>
                        <th>POINTS</th>
                        <th>EARNINGS</th>
                        <th>EVENTS</th>
                        <th>FiR %</th>
                        <th>GiR %</th>
                        <th>SCRAM %</th>
                        <th>NTP (ft)</th>
                    </tr>
                </thead>
                <tbody id="bonus-body"></tbody>
            </table>
        </div>
        
        <div class="section-title">SEASON EVENT HISTORY</div>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>EVENT</th>
                        <th>VENUE</th>
                        <th>DATE</th>
                        <th>WINNER</th>
                        <th>PRIZE</th>
                    </tr>
                </thead>
                <tbody id="history-body"></tbody>
            </table>
        </div>
        
        <div class="section-title">HALL OF FAME (TOP 3)</div>
        <div id="hof-display" style="display: flex; justify-content: space-around; padding: 20px;"></div>
    </div>
</div>

<script>
    // --- CONFIGURATION ---
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSoGXmOEYNiMsVMIlQv-PCbb_rMZibcL8t1nhjgwUeT-Fi35kBGD6ED81g7zQEsa726jVI7jax5Tvbx/pub?output=csv';
    const GID_LB = '&gid=0';
    const GID_STATS = '&gid=349486530'; 
    const GID_HIST = '&gid=1886101746'; // Update this!

    async function loadData() {
        const cacheBuster = `&t=${new Date().getTime()}`;

        // 1. Load Leaderboard
        try {
            const res = await fetch(CSV_URL + GID_LB + cacheBuster);
            renderLB(await res.text());
        } catch (e) { console.error("LB Error"); }

        // 2. Load Stats
        try {
            const statRes = await fetch(CSV_URL + GID_STATS + cacheBuster);
            renderStats(await statRes.text());
        } catch (e) { console.error("Stats Error"); }

        // 3. Load History
        try {
            const histRes = await fetch(CSV_URL + GID_HIST + cacheBuster);
            renderHistory(await histRes.text());
        } catch (e) { 
            console.error("History Error:", e);
            document.getElementById('history-body').innerHTML = "<tr><td colspan='5'>Error loading history. Check GID/Publish settings.</td></tr>";
        }
    }

function renderLB(csv) {
    const rows = csv.split(/\r?\n/).filter(row => row.trim() !== "");
    const tbody = document.getElementById('leaderboard-body');
    tbody.innerHTML = '';
    
    // We look at rows[2] (the first player row) to grab the tournament details
    // --- Metadata Update ---
    const firstDataRow = rows[2].split(',').map(item => item.trim());
    // Metadata Mapping
const venueName  = firstDataRow[10] || "Tournament Venue"; // Col K
const coursePar  = firstDataRow[11] || "72";               // Col L
const totalPrize = firstDataRow[12] || "$0";               // Col M
const eventDate  = firstDataRow[13] || "TBD";              // Col N

// Update Black Bar
document.getElementById('event-date').innerText = eventDate;
document.getElementById('course-par').innerText = coursePar;

// Update Venue/Prize
document.getElementById('current-venue').innerText = venueName;
document.getElementById('total-prize-pool').innerText = `Total Prize Pool: ${totalPrize}`;
    
    // 1. Map and Prepare Data
    let playersData = rows.slice(2).map((row) => {
        const col = row.split(',').map(item => item.trim());
        if (!col[1]) return null;

        const scores = [col[3], col[4], col[5], col[6]].map(s => parseInt(s) || 0);
        const valid = scores.filter(s => s > 0);
        const total = valid.reduce((a, b) => a + b, 0);
        
        // Math uses the Par from Column L
        const toPar = valid.length > 0 ? total - (coursePar * valid.length) : ---;
        const toPar = valid.length > 0 ? total - (coursePar * valid.length) : 999;

        // Platform Icons (Column J / Index 9)
        let iconHtml = '';
@ -388,3 +388,4 @@ function renderStats(csv) {
</body>
</html>



